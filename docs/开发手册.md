## ğŸ“˜ nodeLaravelFramework å¼€å‘æ‰‹å†Œ

### 1. é¡¹ç›®æ¶æ„æ¦‚è§ˆ

æ¡†æ¶é‡‡ç”¨äº†åˆ†å±‚æ¶æ„ï¼Œç¡®ä¿é€»è¾‘æ¸…æ™°ä¸”æ˜“äºæ‰©å±•ï¼š

* **`src/app/Http`**: åŒ…å«æ§åˆ¶å™¨ (Controllers) å’Œä¸­é—´ä»¶ (Middleware)ã€‚
* **`src/app/Models`**: æ•°æ®åº“æ¨¡å‹ï¼ŒåŸºäº Objection.js (Eloquent é£æ ¼)ã€‚
* **`src/app/Services`**: å­˜æ”¾ä¸šåŠ¡é€»è¾‘ã€ç¼“å­˜å¤„ç†ç­‰æ ¸å¿ƒæœåŠ¡ã€‚
* **`src/app/Jobs` & `Events**`: å¤„ç†å¼‚æ­¥ä»»åŠ¡å’Œç³»ç»Ÿäº‹ä»¶ã€‚
* **`src/bootstrap`**: å®¹å™¨é…ç½®ä¸åº”ç”¨å¼•å¯¼é€»è¾‘ã€‚

---

### 2. æ•°æ®åº“ä¸æ¨¡å‹ (ORM)

#### åˆ›å»ºæ¨¡å‹

æ‰€æœ‰æ¨¡å‹åº”ç»§æ‰¿ `BaseModel`ã€‚æ¡†æ¶ä¼šè‡ªåŠ¨å¤„ç† `snake_case` (DB) åˆ° `camelCase` (JS) çš„è½¬æ¢ã€‚

```typescript
// src/app/Models/Users.ts
import { BaseModel } from '#app/Models/BaseModel';

export class Users extends BaseModel {
  id!: number;
  username!: string;

  static get tableName() {
    return `${process.env.DB_PREFIX}users`;
  }
}

```

#### æ•°æ®åº“æŸ¥è¯¢

```typescript
const user = await Users.query().findById(1);
const activeUsers = await Users.query().where('isActive', true).orderBy('createdAt', 'desc');

```

---

### 3. ç¼“å­˜ç³»ç»Ÿ (Cache)

æ”¯æŒ `file`ã€`redis`ã€`sqlite` å¤šé©±åŠ¨ï¼Œé€šè¿‡ `.env` ä¸­çš„ `CACHE_DRIVER` åˆ‡æ¢ã€‚

* **åŸºæœ¬ç”¨æ³•**:
```typescript
import { CacheService } from '#app/Services/Cache/CacheService';

// å­˜å–æ•°æ® (å¸¦ 3600 ç§’æœ‰æ•ˆæœŸ)
await CacheService.set('key', { name: 'Gemini' }, 3600);
const data = await CacheService.get('key');

// è®°ä½ç¼“å­˜ (è‹¥ä¸å­˜åœ¨åˆ™æ‰§è¡Œå›è°ƒå¹¶å­˜å‚¨)
const users = await CacheService.remember('all_users', 600, async () => {
  return await Users.query();
});

```

---

### 4. å®‰å…¨ä¸åŠ è§£å¯† (Security)

æ¡†æ¶å†…ç½®äº†å…¨é“¾è·¯å®‰å…¨æ–¹æ¡ˆï¼Œé€šè¿‡ä¸­é—´ä»¶åœ¨ `src/routes/api.ts` ä¸­é…ç½®ã€‚

| åŠŸèƒ½ | ç¯å¢ƒå˜é‡ | ä¸­é—´ä»¶ | è¯´æ˜ |
| --- | --- | --- | --- |
| **è¯·æ±‚ç­¾å** | `REQUEST_ENCRYPT=true` | `verifySignature` | æ ¡éªŒ API è¯·æ±‚çš„åˆæ³•æ€§ã€‚ |
| **æ•°æ®è§£å¯†** | `REQUEST_ENCRYPT=true` | `decryptRequest` | è‡ªåŠ¨è§£å¯†å‰ç«¯ POST çš„ AES å¯†æ–‡ã€‚ |
| **å“åº”åŠ å¯†** | `RETURN_ENCRYPT=true` | `encryptResponse` | è‡ªåŠ¨åŠ å¯†è¿”å›ç»™å‰ç«¯çš„æ•°æ®ã€‚ |

---

### 5. å¼‚æ­¥ä»»åŠ¡ä¸é˜Ÿåˆ— (Queue)

#### ç¬¬ä¸€æ­¥ï¼šåˆ›å»º Job

```typescript
// src/app/Jobs/SendEmailJob.ts
export class SendEmailJob extends Job {
  constructor(public params: { email: string }) { super(); }
  async handle() { 
    // å‘é€é€»è¾‘... 
  }
}

```

#### ç¬¬äºŒæ­¥ï¼šæ³¨å†Œ Job

åœ¨ `src/app/Console/Commands/QueueWorker.ts` çš„ `jobRegistry` ä¸­æ·»åŠ è¯¥ç±»ã€‚

#### ç¬¬ä¸‰æ­¥ï¼šåˆ†å‘ä¸è¿è¡Œ

```typescript
// æ§åˆ¶å™¨ä¸­åˆ†å‘
await SendEmailJob.dispatch({ email: 'user@example.com' });

// ç»ˆç«¯å¯åŠ¨æ¶ˆè´¹è€…
npm run artisan queue:work

```

---

### 6. Artisan å‘½ä»¤è¡Œå·¥å…·

æˆ‘ä»¬æä¾›äº†ç±»ä¼¼ Laravel çš„å‘½ä»¤è¡Œå…¥å£ï¼š

* **`npm run artisan queue:work`**: å¯åŠ¨ä»»åŠ¡é˜Ÿåˆ—ç›‘å¬ã€‚
* **`npm run artisan cache:clear`**: æ¸…ç©ºå½“å‰é©±åŠ¨ä¸‹çš„æ‰€æœ‰ç¼“å­˜ã€‚
* **`npm run artisan storage:link`**: åˆ›å»ºå­˜å‚¨ç›®å½•çš„ç¬¦å·é“¾æ¥ã€‚

---

### 7. å¼€å‘è§„çº¦

1. **è·¯å¾„åˆ«å**: ä½¿ç”¨ `#app/*` æŒ‡å‘ `src/app/*`ï¼Œä½¿ç”¨ `#bootstrap/*` æŒ‡å‘ `src/bootstrap/*`ã€‚
2. **å“åº”è§„èŒƒ**: æ§åˆ¶å™¨ä¸­å¿…é¡»ä½¿ç”¨ `res.success(data)` æˆ– `res.error(msg, code)`ï¼Œä»¥ç¡®ä¿å‰ç«¯æ”¶åˆ°ç»Ÿä¸€çš„ JSON æ ¼å¼ã€‚
3. **æ—¶é—´å¤„ç†**: æ¨¡å‹è¿”å›çš„æ—¶é—´é»˜è®¤é€šè¿‡ `BaseModel` è½¬æ¢ä¸º `TIME_ZONE` ç¯å¢ƒæŒ‡å®šçš„æ—¶åŒºå­—ç¬¦ä¸²ã€‚

---

### 8. å¿«é€Ÿå¼€å§‹æ¸…å•

1. å¤åˆ¶ `.env.example` å¹¶é…ç½®æ•°æ®åº“åŠ `APP_KEY`ã€‚
2. è¿è¡Œè¿ç§»ï¼š`npx knex migrate:latest`ã€‚
3. è¿è¡Œç§å­æ•°æ®ï¼š`npx knex seed:run`ã€‚
4. å¯åŠ¨å¼€å‘æœåŠ¡å™¨ï¼š`npm run dev`ã€‚

---

## 9. æµ‹è¯•

å…³äºå•å…ƒæµ‹è¯•æ–¹æ¡ˆï¼Œæˆ‘ç›®å‰æœ‰äº›çŠ¹è±«ã€‚å¦‚æœåç«¯å•å…ƒæµ‹è¯•åšå¾—è¿‡äºå¤æ‚ï¼Œå¯èƒ½éœ€è¦æŠ•å…¥å¤§é‡å¼€å‘æ—¶é—´ã€‚æˆ‘åœ¨è€ƒè™‘ï¼Œæ˜¯å¦å¯ä»¥å°†æ›´å¤šæµ‹è¯•å·¥ä½œè½¬ç§»åˆ° Postman æˆ– Apikit ç­‰å·¥å…·æ¥å®Œæˆï¼Œä»¥æå‡æµ‹è¯•æ•ˆç‡ï¼ŒåŒæ—¶æ§åˆ¶å¼€å‘æˆæœ¬ã€‚